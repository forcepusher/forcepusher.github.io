<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>Igromania</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: black;
    }
  </style>
</head>

<body>
  <script type="module" src="index.mjs"></script>
  <script>
    (function () {
      if (window.__buttonTracker) return;
      const events = [];
      const MAX_TEXT = 200;
      function now() { return new Date().toISOString(); }
      function shortText(s) {
        if (!s) return "";
        s = String(s).trim().replace(/\s+/g, " ");
        return s.length > MAX_TEXT ? s.slice(0, MAX_TEXT) + "â€¦" : s;
      }
      function cssPath(el) {
        if (!el || el === document) return "";
        try {
          if (el.id) return `#${el.id}`;
          const parts = [];
          while (el && el.nodeType === 1 && el !== document.body) {
            let part = el.nodeName.toLowerCase();
            if (el.className) {
              const cls = String(el.className).trim().split(/\s+/)[0];
              if (cls) part += `.${cls}`;
            }
            const parent = el.parentElement;
            if (parent) {
              const siblings = Array.from(parent.children).filter(c => c.nodeName === el.nodeName);
              if (siblings.length > 1) {
                const index = Array.prototype.indexOf.call(parent.children, el) + 1;
                part += `:nth-child(${index})`;
              }
            }
            parts.unshift(part);
            el = parent;
          }
          return parts.length ? parts.join(" > ") : "";
        } catch (err) { return ""; }
      }
      function summarizeTarget(t) {
        try {
          return {
            tag: t && t.tagName ? t.tagName.toLowerCase() : null,
            id: t && t.id ? t.id : null,
            classes: t && t.className ? String(t.className).trim() : null,
            role: t && t.getAttribute ? t.getAttribute('role') : null,
            name: t && t.getAttribute ? (t.getAttribute('name') || t.getAttribute('aria-label')) : null,
            value: t && t.value != null ? String(t.value) : null,
            typeAttr: t && t.getAttribute ? t.getAttribute('type') : null,
            text: shortText(t && (t.innerText || t.textContent || t.value) || ""),
            selector: cssPath(t)
          };
        } catch (err) { return {}; }
      }

      function isButtonLikeSummary(s) {
        if (!s) return false;
        if (s.tag === 'button') return true;
        if (s.tag === 'input' && s.typeAttr && ['button','submit'].includes(s.typeAttr.toLowerCase())) return true;
        if (s.role && s.role.toLowerCase() === 'button') return true;
        if (s.selector && /button|\[role=(?:"|')?button(?:"|')?/.test(s.selector)) return true;
        return false;
      }

      function record(item) {
        item.ts = now();
        events.push(item);
        try {
          const shouldLog = item.type && (/click|submit|programmatic|keyboard/.test(item.type)) || (item.meta && item.meta.keyboardActivated) || isButtonLikeSummary(item.target);
          if (shouldLog) {
            console.log('[button-tracker]', item.type, item.target && item.target.selector, item);
          }
        } catch (err) {}
      }

      function handleEvent(e) {
        const t = e.target || e.srcElement;
        const base = {
          type: e.type,
          target: summarizeTarget(t),
          meta: {}
        };
        if (e instanceof KeyboardEvent) {
          base.meta.key = e.key;
          base.meta.code = e.code;
          base.meta.keyCode = e.keyCode;
          if (e.type === 'keydown' && (e.key === 'Enter' || e.key === ' ' || e.keyCode === 13 || e.keyCode === 32)) {
            const active = document.activeElement;
            const activated = (active && (active.closest && (active.closest('button,input[type="button"],input[type="submit"],[role="button"]')))) || active;
            if (activated) {
              base.meta.keyboardActivated = true;
              base.meta.activatedSelector = cssPath(activated);
              base.meta.activatedTag = activated.tagName ? activated.tagName.toLowerCase() : null;
              base.target = summarizeTarget(activated);
            }
          }
        }
        if (e instanceof MouseEvent || e instanceof PointerEvent) {
          base.meta.button = e.button;
          base.meta.clientX = e.clientX;
          base.meta.clientY = e.clientY;
        }
        if (e instanceof TouchEvent) base.meta.touches = e.touches ? e.touches.length : 0;
        record(base);
      }

      const listenEvents = [
        'click','dblclick','auxclick','contextmenu',
        'pointerdown','pointerup','mousedown','mouseup',
        'touchstart','touchend',
        'keydown','keyup','keypress',
        'submit'
      ];

      listenEvents.forEach(name => {
        try { document.addEventListener(name, handleEvent, { capture: true, passive: true }); } catch (err) { try { document.addEventListener(name, handleEvent, true); } catch (e) {} }
      });

      (function patchProto(proto, methodName, label) {
        if (!proto) return;
        const orig = proto[methodName];
        if (!orig || orig.__patchedByButtonTracker) return;
        const wrapper = function () {
          try {
            record({ type: 'programmatic-' + (label || methodName), target: summarizeTarget(this), meta: { argsLength: arguments.length } });
          } catch (err) {}
          return orig.apply(this, arguments);
        };
        wrapper.__patchedByButtonTracker = true;
        proto[methodName] = wrapper;
      })(Element.prototype, 'click', 'click');

      (function () {
        const proto = HTMLFormElement && HTMLFormElement.prototype;
        if (!proto) return;
        const orig = proto.submit;
        if (!orig || orig.__patchedByButtonTracker) return;
        const wrapper = function () {
          try { record({ type: 'programmatic-submit', target: summarizeTarget(this) }); } catch (err) {}
          return orig.apply(this, arguments);
        };
        wrapper.__patchedByButtonTracker = true;
        proto.submit = wrapper;
      })();

      window.__buttonTracker = {
        getEvents: () => events.slice(),
        clear: () => { events.length = 0; },
        download: (filename = 'button-events.json') => {
          const blob = new Blob([JSON.stringify(events, null, 2)], { type: 'application/json' });
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
        },
        stop: () => { listenEvents.forEach(name => { try { document.removeEventListener(name, handleEvent, { capture: true }); } catch {} try { document.removeEventListener(name, handleEvent, true); } catch {} }); },
        start: () => { listenEvents.forEach(name => { try { document.addEventListener(name, handleEvent, { capture: true, passive: true }); } catch {} }); }
      };
    })();
  </script>
</body>

</html>